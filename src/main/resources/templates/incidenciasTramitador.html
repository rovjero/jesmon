<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Jesmon Seguridad</title>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
<div th:replace="fragments/header.html :: header-css" />

<script type="text/javascript">

	jQuery(document).ready( function() {
		jQuery(".fecha").datepicker({changeYear:true});
	});

	function FnBuscarSedes(){
		var idEmpresa = jQuery("#idEmpresa").val();
		//alert(idEmpresa);
		if(idEmpresa == "")
			document.getElementById("idSede").options.length = 0;
		else {
			var parametros = {};
			parametros["idEmpresa"] = idEmpresa;
			
			jQuery.ajax({
				url: "listaSedes",
				dataType: "json",
				data: parametros,
				type: "post",
				async: false,
				success: function(data) {
					var selectSede = jQuery("#idSede")[0];
					selectSede.options[0] = new Option ("", "");
					jQuery(data).each(function(indice, sede){
						selectSede.options[indice + 1] = new Option (sede.denominacion, sede.idSede);
					});
				},
				error: function(data) {
					alert("Error: no se ha podido cargar la lista de sedes.")
				}				
			});
		}
	}

	function FnBuscarResponsables(){
		var idEmpresa = jQuery("#idEmpresa").val();
		//alert(idEmpresa);
		if(idEmpresa == "")
			document.getElementById("idResponsable").options.length = 0;
		else {
			var parametros = {};
			parametros["idEmpresa"] = idEmpresa;
			
			jQuery.ajax({
				url: "listaResponsables",
				dataType: "json",
				data: parametros,
				type: "post",
				async: false,
				success: function(data) {
					var select = jQuery("#idResponsable")[0];
					select.options[0] = new Option ("", "");	
					jQuery(data).each(function(indice, responsable){
						select.options[indice + 1] = new Option (responsable.nombreCompleto, responsable.idResponsable);
					});
				},
				error: function(data) {
					alert("Error: no se ha podido cargar la lista de responsables.")
				}				
			});
		}
	}
	
</script>


</head>
<body>
	<div th:replace="fragments/header.html :: navegacion" />

	<br />
	<form action="incidencias" method="post"
		th:object="${buscadorIncidenciasForm}">
		<div class="container">
			<div class="bd-example-row">
				<div class="row">
					<h2 class="col-12 text-primary" style="font-weight: bold">Buscador
						de incidencias</h2>
				</div>
				<div class="row">
					<div class="form-group col-4">
						<label for="idEstado">Estado</label> <select name="idEstado"
							id="idEstado">
							<option></option>
							<option th:each="estado : ${listaEstados}"
								th:value="${estado.idEstado}" th:text="${estado.descripcion}"
								th:selected="${estado.idEstado ==  buscadorIncidenciasForm.idEstado}" />
						</select>
					</div>
					<div class="form-group col-4">
						<label for="idEmpresa">Empresa</label> <select name="idEmpresa"
							id="idEmpresa" onchange="FnBuscarSedes();FnBuscarResponsables()">
							<option></option>
							<option th:each="empresa : ${listaEmpresas}"
								th:value="${empresa.idEmpresa}"
								th:text="${empresa.denominacion}"
								th:selected="${empresa.idEmpresa ==  buscadorIncidenciasForm.idEmpresa}" />
						</select>
					</div>
					<div class="form-group col-4">
						<label for="idSede">Sede</label> <select name="idSede" id="idSede">
							<option></option>
							<option th:each="sede : ${listaSedes}" th:value="${sede.idSede}"
								th:text="${sede.denominacion}"
								th:selected="${sede.idSede ==  buscadorIncidenciasForm.idSede}" />
						</select>
					</div>
				</div>
				<div class="row">
					<div class="form-group col-4">
						<label for="idResponsable">Resposable</label> <select
							name="idResponsable" id="idResponsable">
							<option></option>
							<option th:each="responsable : ${listaResponsables}"
								th:value="${responsable.idResponsable}"
								th:text="${responsable.nombreCompleto}"
								th:selected="${responsable.idResponsable ==  buscadorIncidenciasForm.idResponsable}" />
						</select>
					</div>
					<div class="form-group col-4">
						<label for="fechaAltaDesde">Fecha desde</label> <input type="text"
							name="fechaAltaDesde" id="fechaAltaDesde" class="fecha"
							th:value="${buscadorIncidenciasForm.fechaAltaDesde}" />
					</div>
					<div class="form-group col-4">
						<label for="fechaAltaHasta">Fecha hasta</label> <input type="text"
							name="fechaAltaHasta" id="fechaAltaHasta" class="fecha"
							th:value="${buscadorIncidenciasForm.fechaAltaHasta}" />
					</div>
				</div>
				<div class="row">
					<div class="col-12" align="center">
						<input type="submit" class="btn btn-sm btn-primary" value="Buscar" />
					</div>
				</div>
			</div>
		</div>
	
	<div class="container">
		<div class="starter-template">
			<h2 class="text-primary">Listado Incidencias</h2>
			<table class="table table-striped">
				<thead>
					<tr>
						<th>ID <a th:href="@{../tramitador/incidencias(orden=${orden == 'idIncidencia;desc'} ? 'fechaAlta;asc' : 'idIncidencia;desc')}"><i class="fa fa-fw fa-sort"></i></a></th>
						<th>Fecha <a th:href="@{../tramitador/incidencias(orden=${orden == 'fechaAlta;desc'} ? 'fechaAlta;asc' : 'fechaAlta;desc')}"><i class="fa fa-fw fa-sort"></i></a></th>
						<th>Usuario alta</th>
						<th>Sede</th>
						<th>Empresa</th>
						<th>Estado</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="incidencia : ${listaIncidencias}">
						<td th:text="${incidencia.idIncidencia}">Text ...</td>
						<td th:text="${#dates.format(incidencia.fechaAlta, 'dd/MM/yyyy')}"></td>
						<td th:text="${incidencia.responsable.nombre}">Text ...</td>
						<td th:text="${incidencia.sede.denominacion}">Text ...</td>
						<td th:text="${incidencia.sede.empresa.denominacion}">Text...</td>
						<td th:text="${incidencia.estadoActual.descripcion}">Text ...</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		 <div class="row">
	        <div class="form-group col-md-1">
	            <select class="form-control pagination" id="pageSize" name="pageSize">
	                <option th:each="pageSize : ${pageSizes}" th:text="${pageSize}" th:value="${pageSize}"
	                        th:selected="${pageSize} == ${selectedPageSize}"></option>
	            </select>
	        </div>
	        <div th:if="${totalPages != 1}" class="form-group col-md-11 pagination-centered">
            <ul class="pagination">
                <li th:class="${currentPage == 0} ? disabled">
                    <a class="pageLink" th:href="@{../tramitador/incidencias(pageSize=${selectedPageSize}, page=1, orden=${orden})}">&laquo;</a>
                </li>
                <li th:class="${currentPage == 0} ? disabled">
                    <a class="pageLink" th:href="@{../tramitador/incidencias(pageSize=${selectedPageSize}, page=${currentPage}, orden=${orden})}">&larr;</a>
                </li>
                <li th:class="${currentPage == (page - 1)} ? 'active pointer-disabled'"
                    th:each="page : ${#numbers.sequence(pager.startPage, pager.endPage)}">
                    <a class="pageLink" th:href="@{../tramitador/incidencias(pageSize=${selectedPageSize}, page=${page}, orden=${orden})}"
                       th:text="${page + ', '}"></a>
                </li>
                <li th:class="${currentPage + 1 == totalPages} ? disabled">
                    <a class="pageLink"
                       th:href="@{../tramitador/incidencias(pageSize=${selectedPageSize}, page=${currentPage + 2}, orden=${orden})}">&rarr;</a>
                </li>
                <li th:class="${currentPage + 1 == totalPages} ? disabled">
                    <a class="pageLink"
                       th:href="@{../tramitador/incidencias(pageSize=${selectedPageSize}, page=${totalPages}, orden=${orden})}">&raquo;</a>
                </li>
            </ul>
        </div>
	    </div>

		</div>
	</form>
	<!-- /.container -->


	<div th:replace="fragments/footer.html :: footer" />

</body>
</html>